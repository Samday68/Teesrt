<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>VOLATILITY ANALYZER V.1.0</title>
<style>
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}body{font-family:sans-serif;background:#1a1a1a;color:#fff;margin:0;padding:5px;transition:background-color .3s,color .3s;overflow-x:hidden;overflow-y:auto}body.day-mode{background:#fff;color:#000}#mainContainer{display:flex;gap:8px;max-width:100%;margin:0 auto}#leftSection{flex:1;min-width:280px;max-width:100%}#rightSection{flex:0 0 85px;display:flex;flex-direction:column;gap:6px;position:relative}@media (max-width:768px){#mainContainer{gap:5px}#leftSection{flex:1;min-width:0}#rightSection{flex:0 0 70px}body{padding:3px}}#headerSection{text-align:center;margin:4px 0;width:100%}#headerLogo{width:100%;height:65px;display:block;object-fit:contain;object-position:center;margin:0 auto;transition:opacity .3s}@media (max-width:768px){#headerLogo{height:52px}}#toggleRow{display:flex;gap:15px;justify-content:center;align-items:center;margin:4px auto}#graphToggle{height:20px;font-size:11px;font-weight:900;padding:0 10px;cursor:pointer;border:none;border-radius:5px;background:#d93025;color:#fff}#themeToggle{width:28px;height:28px;border:none;border-radius:50%;background:#333;cursor:pointer;font-size:14px;display:flex;align-items:center;justify-content:center;transition:background .3s}body.day-mode #themeToggle{background:#ffd700}@media (max-width:768px){#toggleRow{gap:12px}#graphToggle{height:18px;font-size:10px;padding:0 8px}#themeToggle{width:24px;height:24px;font-size:12px}}#pairsWrap{width:100%;margin:4px 0;display:flex;align-items:center;gap:4px;flex-wrap:nowrap}#pairs{display:flex;gap:2px;flex-wrap:nowrap;flex:1}.pair-btn{padding:6px 3px;border:none;border-radius:5px;background:#555;color:#fff;cursor:pointer;font-size:8.5px;font-weight:600;flex:1;min-width:45px;transition:background .3s,color .3s}body.day-mode .pair-btn{background:#e0e0e0;color:#000}.pair-btn.active{background:#000;color:#fff}@media (max-width:768px){.pair-btn{padding:5px 2px;font-size:7.5px;min-width:38px}}#startStopBtn{padding:5px 10px;font-size:10px;font-weight:900;cursor:pointer;border:2px solid #4CAF50;border-radius:15px;background:#4CAF50;color:#fff;display:flex;align-items:center;justify-content:center;gap:3px;white-space:nowrap;flex-shrink:0}#startStopBtn.stopped{background:#d93025;border-color:#d93025}@media (max-width:768px){#startStopBtn{padding:4px 8px;font-size:9px}}#topbar{display:flex;gap:3px;margin:4px 0;align-items:center;flex-wrap:wrap}#time{background:#000;color:#fff;padding:3px 6px;border-radius:3px;font-weight:700;font-size:9px;white-space:nowrap;height:21px;display:flex;align-items:center}body.day-mode #time{background:#333}#connectBtn{background:#d93025;color:#fff;border:none;padding:3px 8px;border-radius:3px;cursor:pointer;font-weight:700;font-size:9px;white-space:nowrap;height:21px;display:flex;align-items:center}#connectBtn.connected{background:#4CAF50}#apiInput{flex:1;min-width:80px;background:#0b57d0;color:#fff;border:none;padding:3px 6px;border-radius:3px;font-size:9px;height:21px}#apiInput::placeholder{color:#cce5ff}#saveGroup{display:flex;align-items:center;gap:3px;padding:0 5px;border-radius:3px;outline:2px solid #fff;height:21px}body.day-mode #saveGroup{outline:2px solid #000}#saveCheckbox{width:13px;height:13px;cursor:pointer;accent-color:#0b57d0;background:#fff;border:2px solid #fff;border-radius:2px;padding:2px}body.day-mode #saveCheckbox{background:#fff;border:2px solid #000}#saveLabel{font-size:8px;font-weight:700;cursor:pointer;white-space:nowrap;user-select:none}#price{background:#0b57d0;color:#fff;padding:3px 8px;border-radius:3px;font-weight:700;font-size:10px;text-align:center;white-space:nowrap;height:21px;display:flex;align-items:center}@media (max-width:768px){#time,#connectBtn{font-size:8px;padding:2px 6px;height:19px}#apiInput{font-size:8px;padding:2px 5px;min-width:60px;height:19px}#saveGroup{gap:2px;padding:0 4px;height:19px}#saveCheckbox{width:12px;height:12px}#saveLabel{font-size:7px}#price{font-size:9px;padding:2px 6px;height:19px}}#chartContainer{position:relative;width:100%}#chart{width:100%;height:180px;position:relative;z-index:2}@media (max-width:768px){#chart{height:130px}}#chartWatermark{position:absolute;left:0;top:50%;transform:translateY(-50%);width:100%;height:65px;opacity:.18;pointer-events:none;z-index:1;object-fit:contain;object-position:center;transition:opacity .3s}@media (max-width:768px){#chartWatermark{height:52px}}#xzRowWrap{width:100%;position:relative;margin-top:1px}#numbersTop{display:flex;flex-wrap:nowrap;justify-content:flex-end;overflow:hidden;width:100%;position:relative;padding:3px 0}.num-box{flex:0 0 36px;height:22px;display:flex;justify-content:center;align-items:center;margin:1px;color:#fff;font-size:12px;font-weight:700;border-radius:3px;position:relative}.pattern-highlight-box{position:absolute;border:2px solid #FFD700;box-shadow:0 0 8px rgba(255,215,0,0.6);pointer-events:none;z-index:10;border-radius:3px}@media (max-width:768px){.num-box{flex:0 0 28px;height:18px;font-size:10px;margin:.5px}}.worm-line{position:absolute;height:1px;border-top:2px solid;z-index:5}#gridWrap{width:100%;position:relative;margin-top:2px}#gridTopRow,#gridBottomRow{display:flex;flex-wrap:nowrap;justify-content:flex-end;width:100%}.grid-cell{flex:0 0 36px;height:36px;box-sizing:border-box;background:#1a1a1a;display:flex;align-items:center;justify-content:center;font-weight:900;font-size:16px;line-height:1;padding:0;margin:0;border:2px solid #444;transition:background .3s,border-color .3s}body.day-mode .grid-cell{background:#fff;border-color:#000}@media (max-width:768px){.grid-cell{flex:0 0 28px;height:28px;font-size:13px;border:1.5px solid #444}body.day-mode .grid-cell{border:1.5px solid #000}}.grid-top{border-color:#0b57d0}.grid-bottom{border-color:#d93025}#gridDivider{width:100%;display:flex;justify-content:flex-end;margin:0;height:2px;background:0 0}#gridDividerLine{height:2px;background:#fff;width:0;transition:background .3s}body.day-mode #gridDividerLine{background:#000}.start-box{position:absolute;border:2px solid #fff;pointer-events:none;z-index:50;box-sizing:border-box;transition:border-color .3s}body.day-mode .start-box{border-color:#000}.start-label{position:absolute;top:-10px;left:50%;transform:translateX(-50%);background:orange;color:#000;font-size:8px;font-weight:900;padding:0 3px;line-height:10px;border-radius:2px;white-space:nowrap}#analysisBoxes{width:100%;margin-top:2px;position:relative}#xyBox{position:relative;width:100%;height:340px;border-bottom:2px solid #444;transition:border-color .3s}body.day-mode #xyBox{border-bottom-color:#000}@media (max-width:768px){#xyBox{height:250px}}#xyCanvas{width:100%;height:100%;display:block}#trendAngleBox{width:100%;height:70px;background:#1a1a1a;border:2px solid #444;border-radius:6px;position:absolute;top:0;right:0;display:flex;align-items:center;justify-content:center;transition:background .3s,border-color .3s}body.day-mode #trendAngleBox{background:#f5f5f5;border-color:#ccc}@media (max-width:768px){#trendAngleBox{height:55px}}#trendAngleCanvas{width:100%;height:100%}#trendBellBox{width:100%;height:70px;background:#666;border:2px solid #444;border-radius:6px;position:absolute;top:76px;right:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;transition:background .3s,border-color .3s}#trendBellBox.trend-up{background:#06f;border-color:#04c}#trendBellBox.trend-down{background:#c00;border-color:#900}body.day-mode #trendBellBox{background:#e0e0e0;border-color:#ccc}body.day-mode #trendBellBox.trend-up{background:#06f;border-color:#04c}body.day-mode #trendBellBox.trend-down{background:#c00;border-color:#900}@media (max-width:768px){#trendBellBox{height:55px;top:61px}}#trendBellIcon{font-size:24px;filter:drop-shadow(0 2px 3px rgba(0,0,0,.3))}@media (max-width:768px){#trendBellIcon{font-size:20px}}#trendLabel{font-size:10px;font-weight:900;color:#fff;text-shadow:1px 1px 2px rgba(0,0,0,.5)}@media (max-width:768px){#trendLabel{font-size:9px}}#tradingPanel{width:100%;background:#000;border:2px solid #666;border-radius:6px;padding:5px;display:flex;flex-direction:column;gap:4px;position:absolute;top:152px;right:0}body.day-mode #tradingPanel{background:#f5f5f5;border-color:#ccc}@media (max-width:768px){#tradingPanel{top:122px;padding:4px;gap:3px;border:1.5px solid #666}body.day-mode #tradingPanel{border:1.5px solid #ccc}}.panel-row{display:flex;flex-direction:column;gap:1px}.panel-row-horizontal{display:flex;justify-content:space-between;align-items:center;gap:3px}.panel-label{font-size:8px;font-weight:700}.panel-value{background:#555;color:#fff;padding:4px;border-radius:4px;text-align:center;font-size:10px;font-weight:700;border:1.5px solid #666}body.day-mode .panel-value{background:#fff;color:#000;border-color:#ccc}.panel-input{background:#555;color:#fff;padding:4px;border-radius:4px;text-align:center;font-size:10px;font-weight:700;border:1.5px solid #666}body.day-mode .panel-input{background:#fff;color:#000;border-color:#ccc}#autoBtn{background:#555;color:#fff;padding:2px 6px;border-radius:4px;text-align:center;font-size:8px;font-weight:700;border:1.5px solid #666;cursor:pointer;transition:background .3s}#autoBtn.active{background:#d93025;border-color:#d93025}body.day-mode #autoBtn{background:#fff;color:#000;border-color:#ccc}body.day-mode #autoBtn.active{background:#d93025;color:#fff;border-color:#d93025}@media (max-width:768px){.panel-label{font-size:7px}.panel-value,.panel-input{padding:3px;font-size:8px;border:1px solid #666}body.day-mode .panel-value,body.day-mode .panel-input{border:1px solid #ccc}#autoBtn{padding:2px 4px;font-size:7px;border:1px solid #666}body.day-mode #autoBtn{border:1px solid #ccc}}.trade-buttons{display:flex;flex-direction:column;gap:6px;margin-top:4px}@media (max-width:768px){.trade-buttons{gap:4px;margin-top:2px}}.metal-btn{width:100%;height:42px;border-radius:50%;position:relative;border:none;cursor:pointer;background:radial-gradient(circle at 30% 30%,#fff,#bdbdbd 35%,#8f8f8f 55%,#f5f5f5 75%,#9b9b9b 100%);box-shadow:inset 0 2px 5px rgba(255,255,255,.9),inset 0 -5px 8px rgba(0,0,0,.7),0 8px 15px rgba(0,0,0,.9)}@media (max-width:768px){.metal-btn{height:32px;box-shadow:inset 0 2px 4px rgba(255,255,255,.9),inset 0 -4px 6px rgba(0,0,0,.7),0 6px 10px rgba(0,0,0,.9)}}.metal-btn::before{content:"";position:absolute;inset:5px;border-radius:50%;background:linear-gradient(to bottom,var(--light) 0,var(--mid) 48%,var(--dark) 100%)}@media (max-width:768px){.metal-btn::before{inset:4px}}.metal-btn::after{content:"";position:absolute;inset:7px;border-radius:50%;background:linear-gradient(to bottom,rgba(255,255,255,.45) 0,rgba(255,255,255,.35) 35%,rgba(255,255,255,0) 36%);pointer-events:none}@media (max-width:768px){.metal-btn::after{inset:5px}}.up{--light:#aebcff;--mid:#1e3dff;--dark:#0c1f7a}.down{--light:#ffb8b8;--mid:#c61f1f;--dark:#6b0000}.metal-btn:active{transform:translateY(2px);box-shadow:inset 0 5px 10px rgba(0,0,0,.8),0 5px 8px rgba(0,0,0,.8)}.balance-row{display:flex;justify-content:space-between;align-items:center;margin-top:2px}.balance-label{font-size:8px;font-weight:700}.balance-value{color:#4CAF50;font-size:8px;font-weight:700}@media (max-width:768px){.balance-row{margin-top:1px}.balance-label,.balance-value{font-size:7px}}#tradeChart{width:100%;height:85px;background:#1a1a1a;border:2px solid #666;border-radius:6px;margin-top:5px;position:absolute;top:412px;right:0;display:none}body.day-mode #tradeChart{background:#f5f5f5;border-color:#ccc}@media (max-width:768px){#tradeChart{height:70px;top:312px;border:1.5px solid #666;margin-top:4px}body.day-mode #tradeChart{border:1.5px solid #ccc}}#tradeCanvas{width:100%;height:100%;display:block}
</style>
</head>
<body>
<div id="mainContainer"><div id="leftSection"><div id="headerSection"><img id="headerLogo" src="https://raw.githubusercontent.com/Samday68/Foto-raflar/refs/heads/main/D354DBAF-3EC7-4B5F-ABC1-8EF876797DAA.jpeg" alt="logo" onerror="this.style.display='none';"></div><div id="toggleRow"><button id="graphToggle" onclick="toggleGraph()">XZ</button><button id="themeToggle" onclick="toggleTheme()">üåô</button></div><div id="pairsWrap"><div id="pairs"><button class="pair-btn active" onclick="selectPair(this,'R_100')">100</button><button class="pair-btn" onclick="selectPair(this,'R_75')">75</button><button class="pair-btn" onclick="selectPair(this,'R_50')">50</button><button class="pair-btn" onclick="selectPair(this,'R_25')">25</button><button class="pair-btn" onclick="selectPair(this,'R_10')">10</button><button class="pair-btn" onclick="selectPair(this,'RDBEAR')">BEAR</button><button class="pair-btn" onclick="selectPair(this,'RDBULL')">BULL</button></div><button id="startStopBtn" onclick="toggleStartStop()"><span>‚èª</span><span id="startStopText">START</span></button></div><div id="topbar"><div id="time">GMT 00:00:00</div><button id="connectBtn" onclick="toggleConnect()">Connect</button><input type="text" id="apiInput" placeholder="Enter Token_ID:"><div id="saveGroup"><input type="checkbox" id="saveCheckbox" onchange="toggleSaveToken()"><label id="saveLabel" for="saveCheckbox">Save</label></div><div id="price">0.00</div></div><div id="chartContainer"><img id="chartWatermark" src="https://raw.githubusercontent.com/Samday68/Foto-raflar/refs/heads/main/D354DBAF-3EC7-4B5F-ABC1-8EF876797DAA.jpeg" alt="" onerror="this.style.display='none';"><canvas id="chart"></canvas></div><div id="xzRowWrap"><div id="numbersTop"></div></div><div id="gridWrap"><div id="gridTopRow"></div><div id="gridDivider"><div id="gridDividerLine"></div></div><div id="gridBottomRow"></div></div><div id="analysisBoxes"><div id="xyBox"><canvas id="xyCanvas"></canvas></div></div></div><div id="rightSection"><div id="trendAngleBox"><canvas id="trendAngleCanvas"></canvas></div><div id="trendBellBox"><span id="trendBellIcon">üîî</span><span id="trendLabel">Trend</span></div><div id="tradingPanel"><div class="panel-row-horizontal"><div class="panel-row" style="flex:1;"><div class="panel-label">Duration:</div><div class="panel-value">5</div></div><div id="autoBtn" onclick="toggleAuto()">AUTO</div></div><div class="panel-row"><div class="panel-label">STAKE:</div><input type="number" class="panel-input" id="stakeInput" value="1" min="0.35" step="0.01"></div><div class="trade-buttons"><button class="metal-btn up" onclick="placeTrade('CALL')"></button><button class="metal-btn down" onclick="placeTrade('PUT')"></button></div><div class="balance-row"><span class="balance-label">Balance:</span><span class="balance-value" id="balanceValue">$ 0.00</span></div><div class="balance-row"><span class="balance-label">Profit:</span><span class="balance-value" id="profitValue">$ 0.00</span></div><div class="balance-row"><span class="balance-label">Total:</span><span class="balance-value" id="totalProfitValue">$ 0.00</span></div></div><div id="tradeChart"><canvas id="tradeCanvas"></canvas></div></div></div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>let audioContext=null,lastTrendSignal=null,currentTrendData={direction:null,last3:[],colors:[]},trendStartGlobal=null,ws,derivWS,apiToken="",isRunning=!0,isConnected=!1,isAutoMode=!1,totalProfit=0,prices=[],digits=[],decimalDigits=[],combinedDigits=[],wormLinesTop=[],numColors=[],currentPair="R_100",currentGraph="XZ",gridHistory=[],startCooldown=0,xzTickCounter=0,startGlobalSpan=null,tradeActive=!1,tradeType="",entrySpot=0,exitSpot=0,barrier=0,tradeData=[],contractId=null;function initAudio(){if(!audioContext){audioContext=new(window.AudioContext||window.webkitAudioContext)}if(audioContext&&"suspended"===audioContext.state){audioContext.resume()}return audioContext}function playUpTrendSound(){const e=initAudio();if(!e)return;const t=e.currentTime;[{freq:261.63,start:0,duration:.3},{freq:329.63,start:.25,duration:.3},{freq:392,start:.5,duration:.3},{freq:523.25,start:.75,duration:.5}].forEach((a=>{const r=e.createOscillator(),n=e.createGain();r.type="sine",r.frequency.value=a.freq;const o=t+a.start;n.gain.setValueAtTime(0,o),n.gain.linearRampToValueAtTime(.12,o+.05),n.gain.exponentialRampToValueAtTime(.01,o+a.duration),r.connect(n),n.connect(e.destination),r.start(o),r.stop(o+a.duration)}))}function playDownTrendSound(){const e=initAudio();if(!e)return;const t=e.currentTime;[{freq:392,start:0,duration:.3},{freq:329.63,start:.25,duration:.3},{freq:261.63,start:.5,duration:.3},{freq:220,start:.75,duration:.5}].forEach((a=>{const r=e.createOscillator(),n=e.createGain();r.type="sine",r.frequency.value=a.freq;const o=t+a.start;n.gain.setValueAtTime(0,o),n.gain.linearRampToValueAtTime(.12,o+.05),n.gain.exponentialRampToValueAtTime(.01,o+a.duration),r.connect(n),n.connect(e.destination),r.start(o),r.stop(o+a.duration)}))}function isEvenSequential(e,t){const a=[0,2,4,6,8],r=a.indexOf(e),n=a.indexOf(t);return-1!==r&&-1!==n&&(1===Math.abs(r-n)||(0===r&&4===n||4===r&&0===n))}function detectPatterns(){if("XZ"!==currentGraph)return[];if(decimalDigits.length<4)return[];const e=Math.min(11,decimalDigits.length),t=decimalDigits.slice(-e),a=numColors.slice(-e),r=t.map((e=>{let t=parseInt(e||"0",10);return Number.isNaN(t)&&(t=0),t})),n=[];for(let t=e-4;t>=0;t--){const e=r[t],n=r[t+1],o=r[t+2],i=r[t+3],l=a[t],c=a[t+1],d=a[t+2],s=a[t+3];if(n===o&&c===d&&("blue"===c||"red"===c)){const a=n%2!=0;if(a){if(e%2==0&&i%2==0)return[{start:t,length:4,type:"flat"}]}else if(e%2!=0&&i%2!=0)return[{start:t,length:4,type:"flat"}]}}if(0===n.length)for(let t=e-3;t>=0;t--){const e=r[t],a=r[t+1],o=r[t+2],i=e%2!=0,l=a%2==0,c=o%2==0,d=e%2==0,s=a%2!=0,u=o%2!=0,f=Math.abs(e-o);if(i&&l&&c&&1===f)return[{start:t,length:3,type:"oddeven"}];if(d&&s&&u&&1===f)return[{start:t,length:3,type:"evenodd"}]}if(0===n.length)for(let t=e-3;t>=0;t--){const e=r[t],n=r[t+1],o=r[t+2],i=a[t],l=a[t+1],c=a[t+2];if(e%2==0&&n%2==0&&o%2==0&&i===l&&l===c&&("blue"===i||"red"===i)){if(isEvenSequential(e,n)&&isEvenSequential(e,o))return[{start:t,length:3,type:"evensequence"}]}}return n}function highlightPatterns(){const e=document.getElementById("numbersTop");if(!e)return;e.querySelectorAll(".pattern-highlight-box").forEach((e=>e.remove()));const t=detectPatterns();t.forEach((t=>{const a=Math.min(11,decimalDigits.length),r=e.querySelectorAll(".num-box");if(t.start>=0&&t.start+t.length<=r.length){const a=r[t.start],n=r[t.start+t.length-1];if(a&&n){const r=document.createElement("div");r.className="pattern-highlight-box";const o=e.getBoundingClientRect(),i=a.getBoundingClientRect(),l=n.getBoundingClientRect(),c=i.left-o.left,d=i.top-o.top,s=l.right-i.left,u=i.height;r.style.left=c+"px",r.style.top=d+"px",r.style.width=s+"px",r.style.height=u+"px",e.appendChild(r)}}}))}function toggleAuto(){isAutoMode=!isAutoMode;const e=document.getElementById("autoBtn");isAutoMode?e.classList.add("active"):e.classList.remove("active")}function toggleConnect(){isConnected?disconnectAPI():connectAPI()}function disconnectAPI(){derivWS&&(derivWS.close(),derivWS=null),isConnected=!1;const e=document.getElementById("connectBtn");e.innerText="Connect",e.classList.remove("connected"),document.getElementById("balanceValue").innerText="$ 0.00",document.getElementById("profitValue").innerText="$ 0.00"}function analyzeTrend(){if("XZ"!==currentGraph)return null;if(!startGlobalSpan)return null;if(!trendStartGlobal)return null;if(gridHistory.length<6)return null;const e=gridHistory.length,t=startGlobalSpan.to-(xzTickCounter-e)+1;if(t<0||t>=e-2)return null;const a=[];for(let r=t;r<e;r++)a.push({v:gridHistory[r].v,row:gridHistory[r].row,color:gridHistory[r].effColor});if(a.length<3)return null;const r=a.slice(-3),n=r[0].v,o=r[1].v,i=r[2].v,l=r[0].color,c=r[1].color,d=r[2].color;currentTrendData.last3=[n,o,i],currentTrendData.colors=[l,c,d];let s=null;const u=o>n?"up":o<n?"down":"flat",f=i>o?"up":i<o?"down":"flat",m=i>n?"up":i<n?"down":"flat";if("up"===u&&"up"===f&&"up"===m)s="UP";else if("down"===u&&"down"===f&&"down"===m)s="DOWN";else if("down"===u&&"up"===f?i>n||i>=o?s="UP":void 0:"up"===u&&"down"===f&&(i<n||i<=o?s="DOWN":void 0),!s){const e=[l,c,d].filter((e=>"blue"===e)).length,t=[l,c,d].filter((e=>"red"===e)).length;e>=2&&"up"===m?s="UP":t>=2&&"down"===m&&(s="DOWN")}return s}function showTrendSignal(e){const t=document.getElementById("trendBellBox"),a=document.getElementById("trendLabel");t.classList.remove("trend-up","trend-down"),"UP"===e?(t.classList.add("trend-up"),a.textContent="Trend UP","UP"!==lastTrendSignal&&(playUpTrendSound(),lastTrendSignal="UP")):"DOWN"===e?(t.classList.add("trend-down"),a.textContent="Trend DOWN","DOWN"!==lastTrendSignal&&(playDownTrendSound(),lastTrendSignal="DOWN")):(a.textContent="Trend",lastTrendSignal=null)}function drawTrendAngle(){const e=document.getElementById("trendAngleCanvas");if(!e)return;const t=document.getElementById("trendAngleBox").getBoundingClientRect(),a=window.devicePixelRatio||1;e.width=t.width*a,e.height=t.height*a;const r=e.getContext("2d");if(r.setTransform(a,0,0,a,0,0),r.clearRect(0,0,t.width,t.height),!document.body.classList.contains("day-mode")){const e=t.width,a=t.height*.45;if(r.strokeStyle="#FF9900",r.lineWidth=2,r.beginPath(),r.moveTo(5,a),r.lineTo(e-5,a),r.stroke(),currentTrendData.last3.length>=3){const a=currentTrendData.last3,n=currentTrendData.colors||[],o=.2*e,i=.5*e,l=.8*e,c=.25*t.height,d=.7*t.height,s=c+3*a[0],u=d,f=c+3*(9-a[2]);r.strokeStyle="#fff",r.lineWidth=1.5,r.lineCap="round",r.beginPath(),r.moveTo(o,s),r.lineTo(i,u),r.lineTo(l,f),r.stroke(),[{x:o,y:s},{x:i,y:u},{x:l,y:f}].forEach(((e,t)=>{r.fillStyle="#000",r.beginPath(),r.arc(e.x,e.y,8,0,2*Math.PI),r.fill(),r.strokeStyle="#fff",r.lineWidth=2,r.stroke(),r.font="bold 11px sans-serif",r.fillStyle="blue"===n[t]?"#0066ff":"#cc0000",r.textAlign="center",r.textBaseline="middle",r.fillText(String(a[t]),e.x,e.y)}));const m=u>s?1:-1;r.strokeStyle=m>0?"#ff0000":"#0066ff",r.fillStyle=r.strokeStyle,r.lineWidth=1.5;const h=(o+i)/2-5,p=(s+u)/2;r.beginPath(),r.moveTo(h,p-8*m),r.lineTo(h,p+8*m),r.stroke(),r.beginPath(),r.moveTo(h-5,p+4*m),r.lineTo(h,p+10*m),r.lineTo(h+5,p+4*m),r.fill();const g=f<u?-1:1;r.strokeStyle=g<0?"#0066ff":"#ff0000",r.fillStyle=r.strokeStyle;const y=(i+l)/2+5,v=(u+f)/2;r.beginPath(),r.moveTo(y,v-8*g),r.lineTo(y,v+8*g),r.stroke(),r.beginPath(),r.moveTo(y-5,v+4*g),r.lineTo(y,v+10*g),r.lineTo(y+5,v+4*g),r.fill()}}}function checkAndSignalTrend(){const e=analyzeTrend();e&&showTrendSignal(e),drawTrendAngle()}function loadSavedToken(){const e=localStorage.getItem("apiToken");e&&(document.getElementById("apiInput").value=e,document.getElementById("saveCheckbox").checked=!0)}function toggleSaveToken(){const e=document.getElementById("saveCheckbox"),t=document.getElementById("apiInput");e.checked?t.value.trim()&&localStorage.setItem("apiToken",t.value.trim()):localStorage.removeItem("apiToken")}function updateLogos(){const e=document.getElementById("headerLogo"),t=document.getElementById("chartWatermark"),a=!document.body.classList.contains("day-mode");a?(e.src="https://raw.githubusercontent.com/Samday68/Foto-raflar/refs/heads/main/D354DBAF-3EC7-4B5F-ABC1-8EF876797DAA.jpeg",t.src="https://raw.githubusercontent.com/Samday68/Foto-raflar/refs/heads/main/D354DBAF-3EC7-4B5F-ABC1-8EF876797DAA.jpeg"):(e.src="https://raw.githubusercontent.com/Samday68/Foto-raflar/refs/heads/main/B3F65E6D-3FB0-45E3-A46A-7E788A46DEC7.jpeg",t.src="https://raw.githubusercontent.com/Samday68/Foto-raflar/refs/heads/main/B3F65E6D-3FB0-45E3-A46A-7E788A46DEC7.jpeg")}function toggleTheme(){const e=document.body,t=document.getElementById("themeToggle");e.classList.toggle("day-mode"),t.innerText=e.classList.contains("day-mode")?"‚òÄÔ∏è":"üåô",updateLogos(),updateChartColors(),chart.update(),renderXYArea(),drawTrendAngle(),tradeActive&&drawTradeChart()}function toggleStartStop(){isRunning=!isRunning;const e=document.getElementById("startStopBtn"),t=document.getElementById("startStopText");isRunning?(e.classList.remove("stopped"),t.innerText="START",startWS()):(e.classList.add("stopped"),t.innerText="STOP",ws&&ws.close())}function connectAPI(){if(apiToken=document.getElementById("apiInput").value.trim(),!apiToken)return void alert("Lutfen gecerli bir API token girin!");(derivWS=new WebSocket("wss://ws.binaryws.com/websockets/v3?app_id=1089")).onopen=(()=>{derivWS.send(JSON.stringify({authorize:apiToken}))}),derivWS.onmessage=(e=>{const t=JSON.parse(e.data);if(t.authorize&&(isConnected=!0,document.getElementById("connectBtn").innerText="Disconnect",document.getElementById("connectBtn").classList.add("connected"),alert("API Baglantisi Basarili!"),t.authorize.balance&&(document.getElementById("balanceValue").innerText="$ "+parseFloat(t.authorize.balance).toFixed(2)),derivWS.send(JSON.stringify({balance:1,subscribe:1}))),t.balance&&(document.getElementById("balanceValue").innerText="$ "+parseFloat(t.balance.balance).toFixed(2)),t.proposal_open_contract){const e=t.proposal_open_contract;if(tradeActive&&e.tick_stream){const t=e.tick_stream;if(0===tradeData.length&&t.length>0&&(entrySpot=parseFloat(t[0].tick),barrier=parseFloat(e.barrier||entrySpot),tradeData=[entrySpot],document.getElementById("tradeChart").style.display="block"),t.length>tradeData.length&&tradeData.length<6)for(let e=tradeData.length;e<Math.min(t.length,6);e++)tradeData.push(parseFloat(t[e].tick));drawTradeChart()}if("won"===e.status||"lost"===e.status){e.exit_tick&&(exitSpot=parseFloat(e.exit_tick));const t=parseFloat(e.profit||0);totalProfit+=t,document.getElementById("profitValue").innerText=(t>=0?"$ +":"$ ")+t.toFixed(2),document.getElementById("totalProfitValue").innerText=(totalProfit>=0?"$ +":"$ ")+totalProfit.toFixed(2),drawTradeChart()}}t.error&&alert("API Hatasi: "+t.error.message)}),derivWS.onerror=(()=>{isConnected=!1;const e=document.getElementById("connectBtn");e.innerText="Connect",e.classList.remove("connected")}),derivWS.onclose=(()=>{isConnected=!1;const e=document.getElementById("connectBtn");e.innerText="Connect",e.classList.remove("connected")})}function placeTrade(e){if(!apiToken||!derivWS||derivWS.readyState!==WebSocket.OPEN)return void alert("Once API baglantisi yapin!");const t=document.getElementById("stakeInput"),a=parseFloat(t.value);if(isNaN(a)||a<.35)return alert("Minimum stake 0.35 USD olmali!"),void(t.value="1");const r={proposal:1,amount:a,basis:"stake",contract_type:e,currency:"USD",duration:5,duration_unit:"t",symbol:currentPair};derivWS.send(JSON.stringify(r)),derivWS.addEventListener("message",(function t(r){const n=JSON.parse(r.data);n.proposal&&derivWS.send(JSON.stringify({buy:n.proposal.id,price:a})),n.buy&&(contractId=n.buy.contract_id,tradeActive=!0,tradeType=e,entrySpot=0,exitSpot=0,barrier=0,tradeData=[],derivWS.send(JSON.stringify({proposal_open_contract:1,contract_id:contractId,subscribe:1})),derivWS.removeEventListener("message",t)),n.error&&(alert("Trade Hatasi: "+n.error.message),derivWS.removeEventListener("message",t))}))}function drawTradeChart(){const e=document.getElementById("tradeCanvas");if(!e||0===tradeData.length)return;const t=e.getBoundingClientRect(),a=window.devicePixelRatio||1;e.width=t.width*a,e.height=t.height*a;const r=e.getContext("2d");r.setTransform(a,0,0,a,0,0),r.clearRect(0,0,t.width,t.height);const n=!document.body.classList.contains("day-mode"),o=t.width,i=t.height,l=[...tradeData,barrier],c=Math.min(...l),d=Math.max(...l),s=d-c||.001,u=c-.1*s,f=d+.1*s,m=f-u;function h(e){return i-12-(e-u)/m*(i-24)}if(tradeData.length>0&&(r.strokeStyle="#FF8C00",r.lineWidth=1.5,r.setLineDash([4,2]),r.beginPath(),r.moveTo(12,12),r.lineTo(12,i-12),r.stroke(),r.setLineDash([]),r.font="7px sans-serif",r.fillStyle="#FF8C00",r.textAlign="center",r.fillText("Entry",12,10)),barrier>0){const e=h(barrier);r.strokeStyle=n?"#fff":"#000",r.lineWidth=2,r.beginPath(),r.moveTo(12,e),r.lineTo(o-12,e),r.stroke(),r.font="7px sans-serif",r.fillStyle=n?"#fff":"#000",r.textAlign="left",r.fillText("Barrier",14,e-3)}if(tradeData.length>0){const e=(o-24)/5;if(r.strokeStyle="#6B8CAE",r.lineWidth=1.5,r.beginPath(),tradeData.forEach(((t,a)=>{const n=12+a*e,o=h(t);0===a?r.moveTo(n,o):r.lineTo(n,o)})),r.stroke(),tradeData.forEach(((t,a)=>{if(a<1)return;const n=12+a*e,o=h(t);r.fillStyle="#6B8CAE",r.beginPath(),r.arc(n,o,3,0,2*Math.PI),r.fill()})),6===tradeData.length){const t=12+5*e;r.strokeStyle="#FF8C00",r.lineWidth=1.5,r.setLineDash([4,2]),r.beginPath(),r.moveTo(t,12),r.lineTo(t,i-12),r.stroke(),r.setLineDash([]),r.font="7px sans-serif",r.fillStyle="#FF8C00",r.textAlign="center",r.fillText("Exit",t,10)}}if(6===tradeData.length&&exitSpot>0){const e="CALL"===tradeType&&exitSpot>barrier||"PUT"===tradeType&&exitSpot<barrier;r.fillStyle=e?"rgba(76, 175, 80, 0.15)":"rgba(244, 67, 54, 0.15)",r.fillRect(0,0,o,i)}}function toggleGraph(){"XZ"===currentGraph?currentGraph="ZZ":"ZZ"===currentGraph?currentGraph="Z.Z":currentGraph="XZ",document.getElementById("graphToggle").innerText=currentGraph,chart.update(),renderXYArea(),renderTwoRowGrid(),renderStartOverlay()}function updateChartColors(){const e=!document.body.classList.contains("day-mode");chart.data.datasets[0].borderColor=e?"#fff":"#000",chart.data.datasets[0].backgroundColor=e?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)",chart.options.scales.y.grid={color:e?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"},chart.options.scales.x.grid={color:e?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"},chart.options.scales.y.ticks={color:e?"#fff":"#000"},chart.options.scales.x.ticks={color:e?"#fff":"#000"}}const ctx=document.getElementById("chart").getContext("2d"),chart=new Chart(ctx,{type:"line",data:{labels:Array.from({length:11},((e,t)=>(t+1).toString())),datasets:[{data:Array(11).fill(null),borderColor:"#fff",borderWidth:1.5,backgroundColor:"rgba(255,255,255,0.05)",pointBackgroundColor:Array(11).fill("#fff"),pointRadius:2,pointHoverRadius:3}]},options:{plugins:{legend:{display:!1},tooltip:{enabled:!1}},scales:{y:{beginAtZero:!1,grid:{color:"rgba(255,255,255,0.1)"},ticks:{color:"#fff"}},x:{grid:{color:"rgba(255,255,255,0.1)"},ticks:{color:"#fff"}}},animation:!1,maintainAspectRatio:!1},plugins:[{afterDatasetsDraw(e){const{ctx:t}=e,a=e.getDatasetMeta(0),r=!document.body.classList.contains("day-mode"),n=decimalDigits.slice(-11),o=numColors.slice(-11),i=n.map((e=>{let t=parseInt(e||"0",10);return Number.isNaN(t)&&(t=0),t}));for(let e=0;e<i.length-1;e++){const n=i[e],l=i[e+1],c=o[e],d=o[e+1];if(1!==Math.abs(n-l))continue;const s=a.data[e],u=a.data[e+1];if(!s||!u)continue;const f=(s.x+u.x)/2,m=(s.y+u.y)/2;let h="";if(t.strokeStyle=r?"#40E0D0":"#000",t.lineWidth=.9,t.beginPath(),t.moveTo(f-18,m),t.lineTo(f+18,m),t.stroke(),t.font="bold 9px sans-serif",t.fillStyle=r?"#40E0D0":"#000",t.textAlign="center",t.textBaseline="middle",t.fillText("VZ",f,m-10),c===d?"blue"===c?h=l>n?"blue":"red":"red"===c&&(h=l<n?"blue":"red"):"blue"===c&&"red"===d?h=n<l?"red":"blue":"red"===c&&"blue"===d&&(h=l>n?"blue":"red"),h){const e=f+35,a=16;t.strokeStyle=h,t.fillStyle=h,t.lineWidth=2,"blue"===h?(t.beginPath(),t.moveTo(e-11.312,m+11.312),t.lineTo(e,m),t.stroke(),t.beginPath(),t.moveTo(e,m),t.lineTo(e-7,m),t.lineTo(e,m+7),t.closePath(),t.fill()):(t.beginPath(),t.moveTo(e-11.312,m-11.312),t.lineTo(e,m),t.stroke(),t.beginPath(),t.moveTo(e,m),t.lineTo(e-7,m),t.lineTo(e,m-7),t.closePath(),t.fill())}}t.font="900 15px sans-serif",t.textAlign="center",t.textBaseline="bottom";const l=digits.slice(-11),c=combinedDigits.slice(-11),d=wormLinesTop.slice(-11);a.data.forEach(((e,a)=>{let s="";if(s="XZ"===currentGraph?n[a]||"":"ZZ"===currentGraph?l[a]||"":(c[a]||"").replace(",","."),e&&void 0!==e.x){let n=o[a]||"#000";n="blue"===n?"#6A9FFF":n,t.fillStyle=n,t.fillText(s,e.x,e.y-2);const i=d[a];"blue"!==i&&"red"!==i||(t.strokeStyle=i,t.lineWidth=2,t.beginPath(),t.moveTo(e.x-5,e.y-2),t.lineTo(e.x+5,e.y-2),t.stroke())}}));const s=a.data[a.data.length-1];s&&void 0!==s.x&&(t.strokeStyle=r?"#40E0D0":"#000",t.lineWidth=.5,t.beginPath(),t.moveTo(e.scales.x.left,s.y),t.lineTo(s.x,s.y),t.stroke())}}]});function selectPair(e,t){currentPair=t,document.querySelectorAll(".pair-btn").forEach((e=>e.classList.remove("active"))),e.classList.add("active"),ws&&ws.close(),prices=[],digits=[],decimalDigits=[],combinedDigits=[],wormLinesTop=[],numColors=[],document.getElementById("numbersTop").innerHTML="",gridHistory=[],startCooldown=0,startGlobalSpan=null,xzTickCounter=0,currentTrendData={direction:null,last3:[],colors:[]},lastTrendSignal=null,trendStartGlobal=null,showTrendSignal(null),renderTwoRowGrid(),renderStartOverlay(),renderXYArea(),drawTrendAngle(),isRunning&&startWS()}function updateWorm(){if(prices.length<20)return;const e=prices.slice(-20),t=Math.max(...e.slice(0,-1)),a=Math.min(...e.slice(0,-1)),r=e[e.length-1];let n="lightgreen";r>t?n="blue":r<a&&(n="red"),wormLinesTop.push(n),wormLinesTop.length>20&&wormLinesTop.shift()}function renderWormLines(e,t){const a=document.getElementById(e);a.querySelectorAll(".worm-line").forEach((e=>e.remove()));a.querySelectorAll(".num-box").forEach(((e,r)=>{if(!t[r])return;const n=document.createElement("div");n.className="worm-line",n.style.width=e.offsetWidth+"px",n.style.left=e.offsetLeft+"px",n.style.top=e.offsetTop+e.offsetHeight+.2+"px",n.style.borderTopColor=t[r],a.appendChild(n)}))}function renderXYArea(){const e=document.getElementById("xyCanvas");if(!e)return;const t=document.getElementById("xyBox").getBoundingClientRect(),a=window.devicePixelRatio||1;e.width=t.width*a,e.height=t.height*a;const r=e.getContext("2d");if(r.setTransform(a,0,0,a,0,0),r.clearRect(0,0,t.width,t.height),"XZ"!==currentGraph)return;const n=Math.min(11,decimalDigits.length);if(n<2)return;const o=decimalDigits.slice(-n),i=numColors.slice(-n),l=!document.body.classList.contains("day-mode"),c=o.map((e=>{let t=parseInt(e||"0",10);return Number.isNaN(t)&&(t=0),0===t&&(t=10),t})),d=t.width,s=t.height,u=32,f=14,m=24,h=(d-64)/(n-1),p=[];for(let e=0;e<n;e++)p.push(u+e*h);const g=s/2,y=(s/2-f-m)/10;function v(e){const t=c[e],a=i[e];return"blue"===a?g-t*y:"red"===a?g+t*y:g}r.strokeStyle=l?"#fff":"#000",r.lineWidth=2,r.beginPath(),r.moveTo(u-10,g),r.lineTo(d-u+10,g),r.stroke();const x=p[n-6]-.15*h;r.lineWidth=2,r.strokeStyle="#0b57d0",r.beginPath(),r.moveTo(x,f-6),r.lineTo(x,g),r.stroke(),r.strokeStyle="#d93025",r.beginPath(),r.moveTo(x,g),r.lineTo(x,s-m+12),r.stroke(),r.font="10px sans-serif",r.textAlign="right",r.textBaseline="middle";for(let e=1;e<=10;e++){const t=g-e*y,a=g+e*y;t>f-4&&(r.fillStyle="#0b57d0",r.fillText(String(e),u-16,t)),a<s-m+6&&(r.fillStyle="#d93025",r.fillText(String(e),u-16,a))}r.strokeStyle="#777",r.lineWidth=2;r.beginPath();for(let e=n-6;e<n;e++){const t=p[e],a=v(e);e===n-6?r.moveTo(t,a):r.lineTo(t,a)}r.stroke(),r.textAlign="center",r.textBaseline="middle",r.font="bold 15px sans-serif";for(let e=0;e<n;e++){const t=p[e],a=v(e),n=i[e];r.fillStyle="blue"===n?"#0b57d0":"red"===n?"#d93025":"#666";const o=10===c[e]?0:c[e];r.fillText(String(o),t,a)}function b(e,t){const a=c[e],n=c[t],o=i[e],l=i[t];if(o!==l)return;if("blue"!==o&&"red"!==o)return;if(1!==Math.abs(a-n))return;const d=p[e],s=p[t],u=v(e),f=v(t),m=(u+f)/2;r.beginPath(),r.moveTo(d-10,m),r.lineTo(s+10,m),r.stroke()}r.strokeStyle=l?"#40E0D0":"#000",r.lineWidth=2.3;for(let e=0;e<n-1;e++)b(e,e+1);const w=Math.max(0,n-6);for(let e=w;e<n;e++)for(let t=e+2;t<n;t++)b(e,t);const C=n-1,k=c[C],T=i[C],I=[];for(let e=1;e<=5;e++){const t=C-e;if(t<0)break;const a=i[t];1===Math.abs(k-c[t])&&T!==a&&"#666"!==T&&"#666"!==a&&I.push(t)}if(I.length>0){r.strokeStyle=l?"#fff":"#000",r.lineWidth=2;const e=p[C],t=v(C);r.beginPath(),r.arc(e,t,10,0,2*Math.PI),r.stroke(),I.forEach((e=>{const t=p[e],a=v(e);r.beginPath(),r.arc(t,a,10,0,2*Math.PI),r.stroke()})),r.font="bold 16px sans-serif",r.textAlign="center",r.textBaseline="middle";let a=10===c[C]?0:c[C];r.fillStyle="blue"===T?"#0b57d0":"red"===T?"#d93025":"#666",r.fillText(String(a),e,t),I.forEach((e=>{const t=p[e],a=v(e),n=i[e],o=10===c[e]?0:c[e];r.fillStyle="blue"===n?"#0b57d0":"red"===n?"#d93025":"#666",r.fillText(String(o),t,a)}))}}function isEven(e){return e%2==0}function decideRow(e,t,a){return e?t===e.v&&a===e.effColor?e.row:e.effColor!==a?"blue"===a?"top":"bottom":"blue"===a?t>e.v?"top":"bottom":t<e.v?"top":"bottom":"blue"===a?"top":"bottom"}function updateGridFromLast11(){if("XZ"!==currentGraph)return gridHistory=[],startGlobalSpan=null,startCooldown=0,renderTwoRowGrid(),void renderStartOverlay();const e=Math.min(11,decimalDigits.length);if(e<=0)return gridHistory=[],renderTwoRowGrid(),void renderStartOverlay();const t=decimalDigits.slice(-e).map((e=>{let t=parseInt(e||"0",10);return Number.isNaN(t)&&(t=0),t})),a=numColors.slice(-e),r=[];for(let e=0;e<t.length;e++){const n=a[e]||"#666",o="blue"===n||"red"===n?n:"#666",i=r.length?r[r.length-1]:null;let l=o;"blue"!==l&&"red"!==l&&(l=i?i.effColor:"blue");const c=decideRow(i,t[e],l);r.push({v:t[e],rawColor:o,effColor:l,row:c})}gridHistory=r,startCooldown>0&&startCooldown--,detectStartGlobal(),renderTwoRowGrid(),renderStartOverlay(),checkAndSignalTrend(),setTimeout(renderStartOverlay,0)}function detectStartGlobal(){if("XZ"!==currentGraph)return;if(startCooldown>0)return;if(gridHistory.length<3)return;const e=gridHistory.length,t=e,a=gridHistory[t-3].v,r=gridHistory[t-2].v,n=gridHistory[t-1].v;if(isEven(a)&&isEven(r)&&!isEven(n)||!isEven(a)&&!isEven(r)&&isEven(n)){const a=xzTickCounter-e;startGlobalSpan={from:a+(t-3),to:a+(t-1)},startCooldown=6,trendStartGlobal=a+(t-1),lastTrendSignal=null,showTrendSignal(null),currentTrendData={direction:null,last3:[],colors:[]}}}function renderTwoRowGrid(){const e=document.getElementById("gridTopRow"),t=document.getElementById("gridBottomRow"),a=document.getElementById("gridDividerLine");if(!e||!t||!a)return;e.innerHTML="",t.innerHTML="";const r=gridHistory.length;if(0===r)return void(a.style.width="0px");for(let a=0;a<r;a++){const r=gridHistory[a],n=document.createElement("div");n.className="grid-cell grid-top";const o=document.createElement("div");o.className="grid-cell grid-bottom";const i="blue"===r.rawColor||"red"===r.rawColor?r.rawColor:r.effColor;"top"===r.row?(n.style.color=i,n.textContent=String(r.v),o.textContent=""):(o.style.color=i,o.textContent=String(r.v),n.textContent=""),e.appendChild(n),t.appendChild(o)}const n=e.querySelector(".grid-cell");a.style.width=r*(n?n.getBoundingClientRect().width:36)+"px"}function renderStartOverlay(){if(document.querySelectorAll(".start-box").forEach((e=>e.remove())),!startGlobalSpan)return;if("XZ"!==currentGraph)return;const e=document.getElementById("gridWrap"),t=document.getElementById("gridTopRow"),a=document.getElementById("gridBottomRow");if(!e||!t||!a)return;const r=t.querySelectorAll(".grid-cell"),n=a.querySelectorAll(".grid-cell"),o=r.length;if(0===o)return;const i=xzTickCounter-o,l=startGlobalSpan.from-i,c=startGlobalSpan.to-i;if(l<0||c>=o)return;const d=r[l],s=r[c],u=n[l],f=n[c];if(!d||!s||!u||!f)return;const m=e.getBoundingClientRect(),h=d.getBoundingClientRect(),p=s.getBoundingClientRect(),g=u.getBoundingClientRect(),y=f.getBoundingClientRect(),v=Math.min(h.left,g.left)-m.left,x=Math.max(p.right,y.right)-m.left,b=Math.min(h.top,g.top)-m.top,w=Math.max(p.bottom,y.bottom)-m.top,C=document.createElement("div");C.className="start-box",C.style.left=v-2+"px",C.style.top=b-2+"px",C.style.width=x-v+4+"px",C.style.height=w-b+4+"px";const k=document.createElement("div");k.className="start-label",k.textContent="start",C.appendChild(k),e.appendChild(C)}function startWS(){(ws=new WebSocket("wss://ws.binaryws.com/websockets/v3?app_id=1089")).onopen=(()=>{ws.send(JSON.stringify({ticks_history:currentPair,end:"latest",count:20,subscribe:1}))}),ws.onmessage=(e=>{const t=JSON.parse(e.data);if(t.history&&t.history.prices.forEach((e=>{const t=String(e),a=parseFloat(e);prices.push(a);const r=t.split("."),n=r[0];let o=r[1]||"0";1===o.length&&(o+="0");const i=n.slice(-2);digits.push(i);const l=o.charAt(o.length-1)||"0";decimalDigits.push(l),xzTickCounter++;const c=n.slice(-1),d=o.charAt(0)||"0";combinedDigits.push(c+","+d),updateWorm()})),t.tick){const e=t.tick.quote.toString(),a=parseFloat(t.tick.quote);prices.push(a);if(prices.length>20){prices.shift()}const priceStr=e;const r=e.split("."),n=r[0];let o=r[1]||"0";if(1===o.length){o+="0"}const i=n.slice(-2);digits.push(i);if(digits.length>20){digits.shift()}const l=o.charAt(o.length-1)||"0";decimalDigits.push(l);if(decimalDigits.length>20){decimalDigits.shift()}xzTickCounter++;const c=n.slice(-1),d=o.charAt(0)||"0";combinedDigits.push(c+","+d);if(combinedDigits.length>20){combinedDigits.shift()}updateWorm();const s=document.getElementById("price");let u=priceStr.split(".")[0];const f=priceStr.split(".")[1]||"0";u=f&&"00"!==f?u+","+f:u+",00",s.innerText=u;if(prices.length>1){if(prices[prices.length-2]<a){s.style.background="blue"}else if(prices[prices.length-2]>a){s.style.background="red"}else{s.style.background="#0b57d0"}}}const a=document.getElementById("numbersTop");a.innerHTML="",numColors=[];let r="XZ"===currentGraph?decimalDigits:"ZZ"===currentGraph?digits:combinedDigits;const n=r.slice(-11);for(let e=0;e<n.length;e++){const t=r.length-11+e,i=t>0&&prices[t]>prices[t-1],l=t>0&&prices[t]<prices[t-1],c=i?"blue":l?"red":"#666";numColors.push(c);const d=document.createElement("div");d.className="num-box",d.style.background=c,d.innerText="Z.Z"===currentGraph?(n[e]||"").replace(",","."):n[e]||"0",a.appendChild(d)}const o=prices.slice(-11);chart.data.datasets[0].data=o,chart.data.datasets[0].pointBackgroundColor=o.map(((e,t)=>0===t?"gray":e>o[t-1]?"blue":e<o[t-1]?"red":"gray")),chart.data.datasets[0].pointBorderColor=Array(o.length).fill("transparent"),chart.data.labels=Array.from({length:o.length},((e,t)=>(t+1).toString())),chart.update(),updateGridFromLast11(),setTimeout((()=>{renderWormLines("numbersTop",wormLinesTop.slice(-11)),renderXYArea(),renderStartOverlay(),drawTrendAngle(),highlightPatterns()}),40)})}function updateTime(){const e=new Date,t=e.getUTCHours().toString().padStart(2,"0"),a=e.getUTCMinutes().toString().padStart(2,"0"),r=e.getUTCSeconds().toString().padStart(2,"0");document.getElementById("time").innerText=`GMT ${t}:${a}:${r}`}setInterval(updateTime,1e3),updateTime(),startWS(),loadSavedToken(),updateLogos(),document.body.addEventListener("click",(function(){initAudio();if(audioContext&&"suspended"===audioContext.state){audioContext.resume()}}),{once:!0}),document.body.addEventListener("touchstart",(function(){if(audioContext&&"suspended"===audioContext.state){audioContext.resume()}}),{passive:!0}),window.addEventListener("resize",(()=>{setTimeout((()=>{renderXYArea(),renderStartOverlay(),renderTwoRowGrid(),drawTrendAngle(),highlightPatterns()}),100)}));
</script>
</body>
</html>
